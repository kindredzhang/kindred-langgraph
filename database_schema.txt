# æµå¼å“åº”ç³»ç»Ÿ - æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡
# ç”¨äºè§‚å¯Ÿå’Œç†è§£æ•°æ®å­˜å‚¨ç»“æ„

================================================================================
                              æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡
================================================================================

## 1. ä¼šè¯è¡¨ (sessions.txt)
================================================================================
è¡¨å: sessions
æè¿°: å­˜å‚¨ç”¨æˆ·ä¼šè¯ä¿¡æ¯

å­—æ®µç»“æ„:
session_id      | VARCHAR(36)  | PRIMARY KEY | ä¼šè¯å”¯ä¸€æ ‡è¯†ç¬¦ (UUID)
user_question   | TEXT         | NOT NULL    | ç”¨æˆ·æå‡ºçš„é—®é¢˜
status          | VARCHAR(20)  | DEFAULT 'active' | ä¼šè¯çŠ¶æ€ (active/completed/error)
created_at      | TIMESTAMP    | NOT NULL    | ä¼šè¯åˆ›å»ºæ—¶é—´
updated_at      | TIMESTAMP    | NOT NULL    | ä¼šè¯æœ€åæ›´æ–°æ—¶é—´

ç´¢å¼•:
- PRIMARY KEY (session_id)
- INDEX idx_status (status)
- INDEX idx_created_at (created_at)

ç¤ºä¾‹æ•°æ®:
session_id                          | user_question        | status    | created_at           | updated_at
123e4567-e89b-12d3-a456-426614174000 | è®¡ç®—25+37æ˜¯å¤šå°‘ï¼Ÿ    | completed | 2024-01-01T10:00:00 | 2024-01-01T10:01:30
223e4567-e89b-12d3-a456-426614174001 | 100é™¤ä»¥4ç­‰äºå¤šå°‘ï¼Ÿ   | completed | 2024-01-01T11:00:00 | 2024-01-01T11:02:15


## 2. æ¶ˆæ¯è¡¨ (messages.txt)
================================================================================
è¡¨å: messages  
æè¿°: å­˜å‚¨æµå¼å“åº”çš„æ‰€æœ‰æ¶ˆæ¯

å­—æ®µç»“æ„:
message_id      | VARCHAR(36)  | PRIMARY KEY | æ¶ˆæ¯å”¯ä¸€æ ‡è¯†ç¬¦ (UUID)
session_id      | VARCHAR(36)  | FOREIGN KEY | å…³è”ä¼šè¯ID
type           | VARCHAR(20)  | NOT NULL    | æ¶ˆæ¯ç±»å‹ (thinking/reasoning/tool_call/tool_result/final_answer/error)
content        | TEXT         | NOT NULL    | æ¶ˆæ¯å†…å®¹
metadata       | JSON         | NULL        | æ¶ˆæ¯å…ƒæ•°æ® (å·¥å…·ä¿¡æ¯ã€æ­¥éª¤ä¿¡æ¯ç­‰)
timestamp      | TIMESTAMP    | NOT NULL    | æ¶ˆæ¯åˆ›å»ºæ—¶é—´

ç´¢å¼•:
- PRIMARY KEY (message_id)
- FOREIGN KEY (session_id) REFERENCES sessions(session_id)
- INDEX idx_session_type (session_id, type)
- INDEX idx_timestamp (timestamp)

ç¤ºä¾‹æ•°æ®:
message_id                          | session_id                          | type      | content                    | metadata                                | timestamp
msg1-4567-e89b-12d3-a456-426614174000 | 123e4567-e89b-12d3-a456-426614174000 | thinking  | ğŸ¤” è®©æˆ‘åˆ†æä¸€ä¸‹ä½ çš„é—®é¢˜... | {"step": "initial_thinking"}          | 2024-01-01T10:00:01
msg2-4567-e89b-12d3-a456-426614174001 | 123e4567-e89b-12d3-a456-426614174000 | reasoning | ğŸ’­ æ¨ç†ç»“æœ: éœ€è¦è®¡ç®—åŠ æ³•   | {"step": "reasoning", "has_tool_calls": true} | 2024-01-01T10:00:05
msg3-4567-e89b-12d3-a456-426614174002 | 123e4567-e89b-12d3-a456-426614174000 | tool_call | ğŸ”§ å‡†å¤‡è°ƒç”¨å·¥å…·: add_numbers | {"tool_name": "add_numbers", "tool_args": {"a": 25, "b": 37}} | 2024-01-01T10:00:10


## 3. å·¥å…·è°ƒç”¨è¡¨ (tool_calls.txt) - å¯é€‰æ‰©å±•
================================================================================
è¡¨å: tool_calls
æè¿°: è¯¦ç»†è®°å½•å·¥å…·è°ƒç”¨ä¿¡æ¯

å­—æ®µç»“æ„:
call_id         | VARCHAR(36)  | PRIMARY KEY | å·¥å…·è°ƒç”¨å”¯ä¸€æ ‡è¯†ç¬¦
session_id      | VARCHAR(36)  | FOREIGN KEY | å…³è”ä¼šè¯ID
tool_name       | VARCHAR(100) | NOT NULL    | å·¥å…·åç§°
tool_args       | JSON         | NOT NULL    | å·¥å…·å‚æ•°
result          | TEXT         | NULL        | å·¥å…·æ‰§è¡Œç»“æœ
success         | BOOLEAN      | DEFAULT true| æ‰§è¡Œæ˜¯å¦æˆåŠŸ
error_message   | TEXT         | NULL        | é”™è¯¯ä¿¡æ¯
execution_time  | INTEGER      | NULL        | æ‰§è¡Œè€—æ—¶(æ¯«ç§’)
created_at      | TIMESTAMP    | NOT NULL    | è°ƒç”¨æ—¶é—´

ç´¢å¼•:
- PRIMARY KEY (call_id)
- FOREIGN KEY (session_id) REFERENCES sessions(session_id)
- INDEX idx_tool_name (tool_name)
- INDEX idx_success (success)


## 4. æ•°æ®å…³ç³»å›¾
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   sessions      â”‚ 1    âˆ  â”‚    messages      â”‚ 1    âˆ  â”‚   tool_calls     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ session_id (PK) â”‚         â”‚ message_id (PK)  â”‚         â”‚ call_id (PK)     â”‚
â”‚ user_question   â”‚         â”‚ session_id (FK)  â”‚         â”‚ session_id (FK)  â”‚
â”‚ status          â”‚         â”‚ type             â”‚         â”‚ tool_name        â”‚
â”‚ created_at      â”‚         â”‚ content          â”‚         â”‚ tool_args        â”‚
â”‚ updated_at      â”‚         â”‚ metadata         â”‚         â”‚ result           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ timestamp        â”‚         â”‚ success          â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ created_at       â”‚
                                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


## 5. æ¶ˆæ¯ç±»å‹è¯´æ˜
================================================================================

thinking     - æ€è€ƒæ¶ˆæ¯: Agentå¼€å§‹åˆ†æé—®é¢˜
reasoning    - æ¨ç†æ¶ˆæ¯: Agentçš„æ¨ç†è¿‡ç¨‹å’Œç»“è®º
tool_call    - å·¥å…·è°ƒç”¨: å‡†å¤‡è°ƒç”¨ç‰¹å®šå·¥å…·
tool_result  - å·¥å…·ç»“æœ: å·¥å…·æ‰§è¡Œåçš„è¿”å›ç»“æœ
final_answer - æœ€ç»ˆç­”æ¡ˆ: Agentç»™å‡ºçš„æœ€ç»ˆå›ç­”
error        - é”™è¯¯æ¶ˆæ¯: å¤„ç†è¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯


## 6. æŸ¥è¯¢ç¤ºä¾‹
================================================================================

-- è·å–æŸä¸ªä¼šè¯çš„å®Œæ•´å¯¹è¯æµ
SELECT m.type, m.content, m.metadata, m.timestamp
FROM messages m
WHERE m.session_id = '123e4567-e89b-12d3-a456-426614174000'
ORDER BY m.timestamp;

-- ç»Ÿè®¡å„ç±»å‹æ¶ˆæ¯æ•°é‡
SELECT type, COUNT(*) as count
FROM messages
GROUP BY type;

-- æŸ¥æ‰¾ä½¿ç”¨äº†å·¥å…·çš„ä¼šè¯
SELECT DISTINCT s.session_id, s.user_question
FROM sessions s
JOIN messages m ON s.session_id = m.session_id
WHERE m.type = 'tool_call';

-- æŸ¥æ‰¾é”™è¯¯ä¼šè¯
SELECT s.session_id, s.user_question, s.status
FROM sessions s
WHERE s.status = 'error'
ORDER BY s.created_at DESC;


## 7. æ€§èƒ½ä¼˜åŒ–å»ºè®®
================================================================================

1. åˆ†åŒºç­–ç•¥: æŒ‰æ—¶é—´åˆ†åŒºï¼Œä¾¿äºå½’æ¡£æ—§æ•°æ®
2. ç´¢å¼•ä¼˜åŒ–: ä¸ºå¸¸ç”¨æŸ¥è¯¢æ·»åŠ å¤åˆç´¢å¼•
3. æ•°æ®æ¸…ç†: å®šæœŸæ¸…ç†è¿‡æœŸçš„ä¸´æ—¶æ•°æ®
4. ç¼“å­˜ç­–ç•¥: å¯¹é¢‘ç¹è®¿é—®çš„ä¼šè¯æ•°æ®ä½¿ç”¨ç¼“å­˜
5. è¯»å†™åˆ†ç¦»: æµå¼å†™å…¥ä¸æŸ¥è¯¢åˆ†ç¦»ï¼Œæé«˜æ€§èƒ½


## 8. æ‰©å±•å­—æ®µå»ºè®®
================================================================================

sessionsè¡¨å¯æ‰©å±•å­—æ®µ:
- user_id: ç”¨æˆ·æ ‡è¯†ç¬¦
- ip_address: ç”¨æˆ·IPåœ°å€
- user_agent: ç”¨æˆ·ä»£ç†ä¿¡æ¯
- language: ç”¨æˆ·è¯­è¨€åå¥½
- priority: ä¼šè¯ä¼˜å…ˆçº§

messagesè¡¨å¯æ‰©å±•å­—æ®µ:
- response_time: å“åº”è€—æ—¶
- model_version: ä½¿ç”¨çš„æ¨¡å‹ç‰ˆæœ¬
- tokens_used: ä½¿ç”¨çš„tokenæ•°é‡
- confidence_score: ç½®ä¿¡åº¦è¯„åˆ†